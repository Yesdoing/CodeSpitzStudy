<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>CodeSpitz Course 1</title>
  </head>
  <body>
    <section id="data"></section>

    <script>
      const Table = (
          _ => {
              // static private 
              const Private = Symbol();
              return class {
                  // constructor
                      constructor(parent) {   
                          if(typeof parent !== 'string' || !parent) throw "invaild param";
                          this[Private] = {parent};
                      }
                  // public method
                    async load(url) {
                        const response = await fetch(url)
                        if(!response.ok) throw "invaild response";
                        const { title, header, items } = await response.json();
                        if(!items) throw "No items";
                        Object.assign(this[Private], {title, header, items});
                        this.render();
                    }
                  // private method
                      render() {
                          // 부모, 데이터 체크
                          const {parent, title, header, items} = this[Private];
                          const parentEl = document.querySelector(parent);
                          if(!parentEl) throw "invaild parent element";
                          if(! items || !items.length) {
                              parentEl.innerHTML = "no data";
                              return;
                          } else parentEl.innerHTML = "";
                          // table 생성 
                          // title을 caption으로 
                          const table = document.createElement('table');
                          const caption = document.createElement('caption');
                          caption.innerHTML = title;
                          table.appendChild(caption);
                          // header를 thead로 
                          table.appendChild(
                              header.reduce((thead, data) => {
                                  const th = document.createElement('th');
                                  th.innerHTML = data;
                                  thead.appendChild(th);
                                  return thead;
                              }, document.createElement('thead'))
                          );
                          // items를 tr로 
                          // 부모를 table에 삽입 
                          items.map(item => item.reduce((tr, data) => {
                              const td = document.createElement('td');
                              td.innerHTML = data;
                              tr.appendChild(td);
                              return tr;
                          }, document.createElement('tr'))).forEach(el => table.appendChild(el));
                          parentEl.appendChild(table);
                      }
              }
          }
      )();
          const table = new Table('#data');
          table.load("http://localhost:3000/course1");
    </script>
  </body>
</html>
